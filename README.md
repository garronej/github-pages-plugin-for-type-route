<p align="center">
    <img src="https://github.com/garronej/github-pages-plugin-for-typeroute/workflows/ci/badge.svg?branch=develop">
</p>

# What?

This is a build tool to enable [`create-react-app`](https://create-react-app.dev) and [`vite`](https://vitejs.dev/) react sites that use [`type-route`](https://typehero.org/type-route) to be deployed on [`gh-pages`](https://pages.github.com).

# The Problem it solves

Github pages has no configuration to enable single pages application.
If you GET `https://my-domain.com/a/b/foo` github page will serve `a/b/foo.html` when in reality we would like that, regardless of the url path, it's always the `index.html` that is served.  
The workaround is to copy the content of `index.html` into a `404.html` file, it works but it's very bad for SEO.

# The solution

Copying the index.html everywhere there is a path before deploying.

# How to set it up with CRA

![image](https://user-images.githubusercontent.com/39378411/281859013-837c1b51-e2e4-4a3b-81de-523a95b3107a.png)

![image](https://user-images.githubusercontent.com/6702424/100515424-7004ca80-317c-11eb-9d7d-c371de576c11.png)

![image](https://user-images.githubusercontent.com/39378411/150363865-061c42d0-4093-4518-a5dc-a320ed0a55d1.png)

> WARNING: In the `router.ts` file you can only perform
> relative import, import using based on the `baseUrl` option
> of the `tsconfig.json` file are not supported.

Then when we run `yarn build` and this will get generated for us:

![image](https://user-images.githubusercontent.com/6702424/100515450-a04c6900-317c-11eb-8153-a5a278ae58cd.png)

All this files are copies of `index.html` generated by the tool:

```json
[
    "auteur.html",
    "evenements.html",
    "naturalisme.html",
    "naturalisme/antilles.html",
    "naturalisme/france.html",
    "naturalisme/ouset-canadiens.html",
    "naturalisme/reunion.html",
    "portrait.html",
    "404.html"
]
```

result: No more 404 ðŸ¥³

# How to set it up with Vite react

## Install

![image](https://user-images.githubusercontent.com/39378411/281859013-837c1b51-e2e4-4a3b-81de-523a95b3107a.png)

## Copy and paste the following code in your `vite.config.ts` file

**Be sure to replace `your-repo-name` with your actual repo name.**

```ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

const base = process.env.NODE_ENV === "production" ? "/your-repo-name" : "";

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  base,
  "define": {
    "__BASE_URL__": JSON.stringify(base)
  }
})
```
In this configuration file, we determine the base URL of the application depending on the environment. If we are in production, we set the base URL to match the repository name, prefixed with a slash. In other environments, the base URL is set to an empty string, implying the root. Additionally, we define a new environment variable `__BASE_URL__` and assign it the value of the base URL. This variable is made available in the Vite environment so it can be used in the `src/router.ts` file.

## Declare the `__BASE_URL__` in your `src/vite-env.d.ts` 

This is a TypeScript declaration that tells TypeScript there is a constant named `__BASE_URL__` that will exist at runtime.
```ts
/// <reference types="vite/client" />
declare const __BASE_URL__: string;
```
Without this declaration, TypeScript would not be aware of `__BASE_URL__` and would give you an error if you tried to reference it in your code. By declaring it, you inform TypeScript that such a variable will exist, thus avoiding the error.

## Your `src/router.ts` file

![image](https://user-images.githubusercontent.com/39378411/281867932-bff9013b-50c6-4d5e-9533-a287301addd1.png)
## Add the following to your `package.json`
![image](https://user-images.githubusercontent.com/39378411/150363865-061c42d0-4093-4518-a5dc-a320ed0a55d1.png)

Now when you run `yarn build` it will work the same as with a `create-react-app` project.


![image](https://user-images.githubusercontent.com/6702424/100515655-fcfc5380-317d-11eb-8f52-7f207e1a24ce.png)

This is a project that uses this module: https://github.com/thieryw/www.theo-tz.com
It's online here: https://theo-tz.com
